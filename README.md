# GCP-JSON-Key-Via-Vault
Queries the Vault API to generate a new JSON key for a GCP Service Account


In order to use this, you must first have a vault server running that is connected to a GCP service account.

This tool also requires a key roleset to be defined, which can be created with:
```
$ vault write gcp/roleset/my-key-roleset \
    project="my-project" \
    secret_type="service_account_key"  \
    bindings=-<<EOF
      resource "//cloudresourcemanager.googleapis.com/projects/my-project" {
        roles = ["roles/viewer"]
      }
    EOF
```

Once the key roleset is defined, run the code with `go run get_key.go` in the directory you want the key file to be put, and the newly generated key file will be created in the directory as `new_key.json`

To manually revoke the key generated by the program, run `vault lease revoke <lease-id>`. The lease ID is printed when the program is run, however a listing of all currently active keys can be found by running `vault list /sys/leases/lookup/gcp/key/my-key-roleset`
